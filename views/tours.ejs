<script>
    const cities = require("./models/cities");
</script>
<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Tours Management Website - Tours</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"> -->

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
        integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/tours.css">
    <link rel="stylesheet" href="/css/nav.css">
</head>

<body>
    <%- include("./partials/nav.ejs") %>
        <main>
            <h2 class="text-center py-4">Tours</h2>
            <section class="tour-list">

                <% for (let i=0; i < cities.length; i++) { %>
                    <article class="cairo">
                        <img src="<%= cities[i].image %>" alt="Tour 1">
                        <h3>
                            <%= cities[i].name %>
                        </h3>
                        <p class="tour-description">
                            <%= cities[i].description %>
                        </p>

                        <a href="/cairotours/get" class="btn">Book Now</a>
                        <button class="wishlist-button add-to-wishlist" data-type="tour" data-id="<%= cities._id %>">Add
                            to Wishlist</button>
                    </article>
                    <% } %>
            </section>
        </main>
        <footer class="f1">
            <p>&copy; 2023 GoEgy Tours Management. All rights reserved.</p>
        </footer>

        <script>
            window.addEventListener('DOMContentLoaded', () => {
                const tourDescriptions = document.querySelectorAll('.tour-description');
                tourDescriptions.forEach((description) => {
                    description.style.height = "auto";
                    const descriptionHeight = description.offsetHeight;
                    description.style.height = descriptionHeight + "px";
                });
            });

            document.querySelectorAll(".add-to-wishlist").forEach((btn) => {
                btn.addEventListener("click", async (e) => {
                    const type = e.target.dataset.type;
                    const itemId = e.target.dataset.id;

                    try {
                        const response = await fetch("/wishlist/add", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ type, itemId }),
                        });

                        if (response.ok) {
                            alert("Added to wishlist!");
                        } else {
                            alert("Error adding to wishlist.");
                        }
                    } catch (error) {
                        console.error("Error:", error);
                        alert("Error adding to wishlist.");
                    }
                });
            });
        </script>


</body>

</html>